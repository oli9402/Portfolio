{
  "hash": "550e2a04b26c8c8cee099cf954ecb1e0",
  "result": {
    "markdown": "---\ntitle: \"Simpson's Paradox\"\nauthor: \"Oliver Zingg\" \ndate: \"09.05.2023\"\ncategories: [Linear Mixed Effects, Statistics, Random Effects]\nimage: \"sp.png\"\nbibliography: ref.bib\n---\n\n\n## Simpson's Paradox\n\nSimpson's Paradox bezeichnet ein statistische Phänomen, in dem die Daten eine hierarchisch angeordnete Struktur aufweisen. Die Analyse der Daten kann deshalb auf unterschiedliche Ebenen dieser Sturktur gemacht werden und Einfluss auf das Resultat haben. Teilweise kann wird dadurch die Interpretation der Forschungsfrage beeinflusst je nach untersuchten Ebenen. Simpson's Paradox wird oft verwendet um die Vorteile von Linear Mixed Effects Model im Vergleich zur einfacher linearen Regression darzustellen.\n\n## Hierarchische Datenstruktur\n\n### Im Querschnitt\n\nBeispiele sind:\n\n-   Schüler genested in Schulen (Zwei Ebenen)\n-   Schüler genested in Schulen genested in Kantonen (Drei Ebenen)\n-   Mitarbeiter genested in Unternehmen (Zwei Ebenen)\n\n### Im Längschnitt\n\nBeispiele sind:\n\n-   Prüfungsnoten genested in Schüler (Zwei Ebenen)\n-   Kundenzufriedenheit genested Person genested in Altersgruppen (Drei Ebenen)\n\n## Visualisierung Simpson's Paradox in R\n\n### Beispiel Pinguine\n\nDaten (@pingu):\n\n-   palmerpenguins\n    -   344 Pinguine\n    -   3 Arten (Adéline, chinstrap und gentoo)\n\nDie Daten wurden von Dr Allison Horst, Alison Hill und Kristen Gorman zu einem R Packet *palmerpenguins* verarbeitet. Das folgende Projekt basiert auf dem [Turtorial](https://slides.silviacanelon.com/tour-of-the-tidyverse) von Silvia Canelon.\n\n**Zuerst, R Packete installieren**\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"palmerpenguins\") #Data\ninstall.packages(\"tibble\") #Data handling\ninstall.packges(\"ggplot2\") #Plotting\ninstall.packages(\"dplyr\")\n```\n:::\n\n\n**Packete laden**\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\nlibrary(tibble)\nlibrary(ggplot2)\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttache Paket: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nDie folgenden Objekte sind maskiert von 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nDie folgenden Objekte sind maskiert von 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\npenguins <- palmerpenguins::penguins\nhead(penguins)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 8\n  species island    bill_length_mm bill_depth_mm flipper_l…¹ body_…² sex    year\n  <fct>   <fct>              <dbl>         <dbl>       <int>   <int> <fct> <int>\n1 Adelie  Torgersen           39.1          18.7         181    3750 male   2007\n2 Adelie  Torgersen           39.5          17.4         186    3800 fema…  2007\n3 Adelie  Torgersen           40.3          18           195    3250 fema…  2007\n4 Adelie  Torgersen           NA            NA            NA      NA <NA>   2007\n5 Adelie  Torgersen           36.7          19.3         193    3450 fema…  2007\n6 Adelie  Torgersen           39.3          20.6         190    3650 male   2007\n# … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g\n```\n:::\n:::\n\n\nVon Interesse sind *bill_length_mm* (Schnabel) und *flipper_length_mm* (Flügel) ![Flügel und Schnabel](bill_flipper.jpg)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins,\n       aes(x = sex, y = body_mass_g))+\n  geom_boxplot(aes(fill = species))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nDie Boxplotte deuten darauf hin, dass bei Gentoo ein geschlechtsspezifischer Unterschiedlich im Body Mass zu sehen ist, wobei dies möglicherweise nicht der Fall ist bei Adelie und Chinstrap.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  select(species, sex, body_mass_g) %>%\n  arrange(desc(body_mass_g))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 344 × 3\n   species sex   body_mass_g\n   <fct>   <fct>       <int>\n 1 Gentoo  male         6300\n 2 Gentoo  male         6050\n 3 Gentoo  male         6000\n 4 Gentoo  male         6000\n 5 Gentoo  male         5950\n 6 Gentoo  male         5950\n 7 Gentoo  male         5850\n 8 Gentoo  male         5850\n 9 Gentoo  male         5850\n10 Gentoo  male         5800\n# … with 334 more rows\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  select(species, sex, body_mass_g) %>%\n  group_by(species,sex) %>%\n  summarize(mean = mean(body_mass_g))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'species'. You can override using the\n`.groups` argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 3\n# Groups:   species [3]\n  species   sex     mean\n  <fct>     <fct>  <dbl>\n1 Adelie    female 3369.\n2 Adelie    male   4043.\n3 Adelie    <NA>     NA \n4 Chinstrap female 3527.\n5 Chinstrap male   3939.\n6 Gentoo    female 4680.\n7 Gentoo    male   5485.\n8 Gentoo    <NA>     NA \n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  group_by(species) %>%\n  mutate(n_species = n()) %>%\n  ungroup() %>%\n  group_by(species,sex,n_species) %>%\n  summarize(n=n())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'species', 'sex'. You can override using\nthe `.groups` argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 4\n# Groups:   species, sex [8]\n  species   sex    n_species     n\n  <fct>     <fct>      <int> <int>\n1 Adelie    female       152    73\n2 Adelie    male         152    73\n3 Adelie    <NA>         152     6\n4 Chinstrap female        68    34\n5 Chinstrap male          68    34\n6 Gentoo    female       124    58\n7 Gentoo    male         124    61\n8 Gentoo    <NA>         124     5\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  count(species, sex) %>%\n  add_count(species, wt = n,\n            name = \"n_species\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 4\n  species   sex        n n_species\n  <fct>     <fct>  <int>     <int>\n1 Adelie    female    73       152\n2 Adelie    male      73       152\n3 Adelie    <NA>       6       152\n4 Chinstrap female    34        68\n5 Chinstrap male      34        68\n6 Gentoo    female    58       124\n7 Gentoo    male      61       124\n8 Gentoo    <NA>       5       124\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  count(species, sex) %>%\n  add_count(species, wt = n,\n            name = \"n_species\") %>%\n  mutate(prop = n/n_species*100)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 5\n  species   sex        n n_species  prop\n  <fct>     <fct>  <int>     <int> <dbl>\n1 Adelie    female    73       152 48.0 \n2 Adelie    male      73       152 48.0 \n3 Adelie    <NA>       6       152  3.95\n4 Chinstrap female    34        68 50   \n5 Chinstrap male      34        68 50   \n6 Gentoo    female    58       124 46.8 \n7 Gentoo    male      61       124 49.2 \n8 Gentoo    <NA>       5       124  4.03\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  count(species, sex) %>%\n  add_count(species, wt = n,\n            name = \"n_species\") %>%\n  mutate(prop = n/n_species*100) %>%\n  filter(species == \"Chinstrap\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  species   sex        n n_species  prop\n  <fct>     <fct>  <int>     <int> <dbl>\n1 Chinstrap female    34        68    50\n2 Chinstrap male      34        68    50\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins_new <-\n  penguins %>%\n  mutate(year_factor = factor(year, levels = unique(year)))\npenguins_new\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 344 × 9\n   species island    bill_length_mm bill_d…¹ flipp…² body_…³ sex    year year_…⁴\n   <fct>   <fct>              <dbl>    <dbl>   <int>   <int> <fct> <int> <fct>  \n 1 Adelie  Torgersen           39.1     18.7     181    3750 male   2007 2007   \n 2 Adelie  Torgersen           39.5     17.4     186    3800 fema…  2007 2007   \n 3 Adelie  Torgersen           40.3     18       195    3250 fema…  2007 2007   \n 4 Adelie  Torgersen           NA       NA        NA      NA <NA>   2007 2007   \n 5 Adelie  Torgersen           36.7     19.3     193    3450 fema…  2007 2007   \n 6 Adelie  Torgersen           39.3     20.6     190    3650 male   2007 2007   \n 7 Adelie  Torgersen           38.9     17.8     181    3625 fema…  2007 2007   \n 8 Adelie  Torgersen           39.2     19.6     195    4675 male   2007 2007   \n 9 Adelie  Torgersen           34.1     18.1     193    3475 <NA>   2007 2007   \n10 Adelie  Torgersen           42       20.2     190    4250 <NA>   2007 2007   \n# … with 334 more rows, and abbreviated variable names ¹​bill_depth_mm,\n#   ²​flipper_length_mm, ³​body_mass_g, ⁴​year_factor\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = penguins,\n       mapping = aes(x = bill_length_mm, y = bill_depth_mm))+\n  geom_point() +\n  geom_smooth(method='lm', formula = y ~x)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins %>%\n  ggplot(mapping = aes(x = bill_length_mm, y = bill_depth_mm, group = species, col = species)) + \n  geom_point() +\n  geom_smooth(method = 'lm', formula = y ~x)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n \n \nMore information on mixed-effects models and simpson's paradox [see @hoxMultilevelAnalysisTechniques2017]\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}